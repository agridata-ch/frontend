<app-consent-request-filter (onClick)="setStateCodeFilter($event)" [requests]="consentRequests()" />
<app-agridata-client-table
  [rawData]="filteredConsentRequests()"
  [tableMetadata]="consentRequestsTableMetaData()"
  [loading]="consentRequestsResource()?.isLoading()"
  class="hidden lg:block"
>
  <ng-template #dataRequestConsumer [appConsentRequestProducerViewDtoGuard] let-item>
    <div class="flex items-center gap-2">
      <app-agridata-contact-card
        [imageUrl]="item.dataRequest?.dataConsumerLogoBase64"
        [name]="item.dataRequest?.dataConsumerDisplayName"
        [secondaryName]="item.dataRequest?.dataConsumerCity"
        [size]="AvatarSize.SMALL"
        [skin]="AvatarSkin.LIGHT"
      />
    </div>
  </ng-template>
  <ng-template #dataRequestTitle [appConsentRequestProducerViewDtoGuard] let-item>
    <span
      class="text-agridata-primary-600 agridata-ellipsis"
      [title]="getTranslation(item.dataRequest?.title)"
    >
      {{ getTranslation(item.dataRequest?.title) }}
    </span>
  </ng-template>
  <ng-template #consentRequestState [appConsentRequestProducerViewDtoGuard] let-item>
    <app-agridata-badge
      [text]="getTranslatedStateValue(item.stateCode)"
      [variant]="getBadgeVariant(item?.stateCode)"
      [size]="BadgeSize.SM"
    />
  </ng-template>
  <ng-template #consentRequestAction [appConsentRequestProducerViewDtoGuard] let-item>
    @if (item.stateCode === ConsentRequestStateEnum.Opened) {
      <app-agridata-button
        click-stop-propagation
        [variant]="ButtonVariants.PrimaryAccept"
        [disabled]="acceptConsentActionDisabled()"
        [loading]="getElementLoadingSignal(item.id)()"
        (onClick)="
          updateConsentRequestState(
            item.id,
            ConsentRequestStateEnum.Granted,
            getTranslation(item.dataRequest?.title)
          )
        "
      >
        {{ 'consent-request.table.tableActions.consent' | i18n }}
      </app-agridata-button>
    }
  </ng-template>
  <
</app-agridata-client-table>
<app-consent-request-list
  class="lg:hidden"
  [consentRequests]="filteredConsentRequests()"
  (openDetails)="openDetails($event)"
  (updateConsentRequestStatus)="updateConsentRequestState($event.id, $event.newState, $event.title)"
/>
